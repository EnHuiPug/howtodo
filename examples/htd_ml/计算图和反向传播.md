## 计算图和反向传播

http://www.cs.columbia.edu/~mcollins/ff2.pdf

### 计算图

用一序列计算步骤的有向图，用来表示模型

vertex节点是计算步骤，有向边edges表示输入的方向

优势： 1. 简单的函数进行组合可以表示复杂的模型；2. 可以自动微分。

定义1: 
$$
\lang n,l,E,u^1...u^n,d^1...d^n,f^{l+1}...f^n \rang
\\
$$
where:

- $n$ is an integer specifying the number of vertices in the graph.

- $l$ is an integer such that $1\le l <n$ that specifies the number of leaves（输入节点） in the graph.

- $E$ is a set of directed edges in the graph. Each edge is an ordered pair  $(j, i)$ where $j ∈ {1 . . . (n − 1)}, i ∈ {(l + 1) . . . n},$ and $j < i$.
- Each $u^i$ for $i = 1...n$ is a **variable** associated with vertex $i$ in the graph. $u^i$ is a variable in $\mathbb{R}^{d^i}$, hence $d^i$ for $i = 1...n$ is an integer specifying the dimensionality of the variable associated with variable $i$.
- We take $u^n$ to be the **output variable**（输出节点） in the graph. Often we have $d^n = 1$, so that the output variable is a scalar; however we will consider the general case where $d^n$ is any integer greater than $0$.
- Each $f^i$ for $i = (l + 1)...n$ is a **local function** associated with vertex $i$ in the graph. If we define $\alpha^i=\lang u^j|(j,i)\in E \rang$ hence $α^i$ （输入向量的加和concat）is a vector formed by concatenating the vectors $u^j$ such that $(j, i) \in E$ and in addition we define $ \bar{d^i}=\sum\limits_{j:(j,i)\in E} d^j$ （输入维度的加和）then we have dimensions $\alpha^i \in \mathbb{R}^{\bar{d^i}}, f^i:\mathbb{R}^{\bar{d^i}}\rarr \mathbb{R}^{d^i}, and f^i(a^i) \in \mathbb{d^i}$.

举个例子

**Example 1**

$$ \begin{matrix} u^3 & \rarr & u^4\\ \uarr & \nwarrow & \uarr \\ u^1 &  & u^2 \end{matrix} $$
$$
n=4, l=2, E=\{(1,3),(2,3),(2,4),(3,4)\}
\\
d^i = 1 \quad for i = 1...4
\\
f^3(u^1,u^2) = u^1+u^2
\\
f^4(u^2,u^3) = u2\times u^3
$$

#### Forward Algorithm 前向

对于除了输入节点的$u^i \quad for i=(l+1)...n$，节点上的变量是这么计算的
$$
u^i = f^i(\alpha^i)
\\
where \quad \alpha^i=\lang u^j|(j,i)\in E \rang
$$
应为计算图上的节点满足拓扑排序，$u^j$肯定在$u^i$之前都计算过了。

向example 1中带入数据进行计算
$$
u^1 = 2, u^2=3
\\
f^3(u^1,u^2) = u^1+u^2=5
\\
f^4(u^2,u^3) = u2\times u^3=15
\\
Output = u^4 = 15
$$
定义2： **全局公式**
$$
If\quad i\in{1...l}
\\
h^i(u^1...u^l)=u^i
\\
else\; if\quad i\in\{(l+1)...n\}
\\
u^i = f^i(\alpha^i)
\\
where \quad \alpha^i=\lang h^j(u^1...u^l)|(j,i)\in E \rang
$$
这后面的$h^j(u^1...u^l)$是要递归的计算的（多层嵌套）

#### 单层前馈网络作为计算图



#### Backpropagation Algorithm 反向传播

